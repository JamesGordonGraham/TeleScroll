// teleprompter.js â€” updated full teleprompter app with camera recording fix

// ==== DOM Elements ====
const startBtn = document.getElementById("start-btn");
const stopBtn = document.getElementById("stop-btn");
const video = document.getElementById("camera-preview");
const teleprompter = document.getElementById("teleprompter-text");
const downloadContainer = document.getElementById("download-container");

// ==== Global Variables ====
let mediaRecorder;
let recordedChunks = [];

// ==== Setup Camera Preview ====
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    video.srcObject = stream;
    video.play();
  } catch (err) {
    console.error("Camera access error:", err);
  }
}

// ==== Start Recording ====
function startRecording() {
  const stream = video.srcObject;
  recordedChunks = [];
  
  mediaRecorder = new MediaRecorder(stream);

  mediaRecorder.ondataavailable = function (e) {
    if (e.data.size > 0) recordedChunks.push(e.data);
  };

  mediaRecorder.onstop = function () {
    const blob = new Blob(recordedChunks, { type: "video/webm" });
    const url = URL.createObjectURL(blob);
    const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
    const filename = `teleprompter-recording-${timestamp}.webm`;

    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.textContent = `Download ${filename}`;
    a.className = "download-link";

    downloadContainer.innerHTML = "";
    downloadContainer.appendChild(a);
  };

  mediaRecorder.start();
  console.log("Recording started...");
}

// ==== Stop Recording ====
function stopRecording() {
  if (mediaRecorder && mediaRecorder.state !== "inactive") {
    mediaRecorder.stop();
    console.log("Recording stopped.");
  }
}

// ==== Event Listeners ====
startBtn.addEventListener("click", () => {
  startRecording();
  // Optionally start teleprompter scroll here
});

stopBtn.addEventListener("click", () => {
  stopRecording();
  // Optionally stop scroll here
});

// ==== Initialize App ====
startCamera();
